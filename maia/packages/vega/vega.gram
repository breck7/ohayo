tooling onsave jtree build produceMaiaGrammar
vegaDataSetCell
 highlightScope constant.numeric
 enum 7zip.png airports.csv anscombe.json barley.json birdstrikes.json budget.json budgets.json burtin.json cars.json climate.json co2-concentration.csv countries.json crimea.json descriptions.json disasters.csv driving.json earthquakes.json ffox.png flare-dependencies.json flare.json flights-10k.json flights-200k.json flights-20k.json flights-2k.json flights-3m.csv flights-5k.json flights-airport.csv gapminder-health-income.csv gapminder.json gimp.png github.csv graticule.json income.json iowa-electricity.csv iris.json jobs.json la-riots.csv londonBoroughs.json londonCentroids.json londonTubeLines.json lookup_groups.csv lookup_people.csv miserables.json monarchs.json movies.json normal-2d.json obesity.json points.json population.json population_engineers_hurricanes.csv seattle-temps.csv seattle-weather.csv sf-temps.csv sp500.csv stocks.csv udistrict.json unemployment-across-industries.json unemployment.tsv us-10m.json us-employment.csv us-state-capitals.json weather.csv weather.json weball26.json wheat.json windvectors.csv world-110m.json zipcodes.csv
vegaExampleNameCell
 highlightScope constant.numeric
 enum airport_connections area area_cumulative_freq area_horizon area_overlay area_temperature_range area_vertical bar bar_1d bar_1d_rangestep_config bar_aggregate bar_aggregate_count bar_aggregate_format bar_aggregate_size bar_aggregate_sort_by_encoding bar_aggregate_sort_mean bar_aggregate_transform bar_aggregate_vertical bar_argmax bar_argmax_transform bar_array_aggregate bar_binned_data bar_color_disabled_scale bar_column_fold bar_custom_sort_full bar_custom_sort_partial bar_distinct bar_diverging_stack_transform bar_filter_calc bar_fit bar_gantt bar_grouped bar_grouped_horizontal bar_layered_transparent bar_layered_weather bar_month bar_month_temporal bar_size_default bar_size_explicit bar_size_explicit_bad bar_size_fit bar_size_rangestep_small bar_sort_by_count bar_swap_axes bar_swap_custom bar_title bar_title_start bar_tooltip bar_tooltip_multi bar_yearmonth bar_yearmonth_custom_format boxplot_1D_horizontal boxplot_1D_horizontal_custom_mark boxplot_1D_horizontal_explicit boxplot_1D_vertical boxplot_2D_horizontal boxplot_2D_horizontal_color_size boxplot_2D_vertical boxplot_minmax_2D_horizontal boxplot_minmax_2D_horizontal_custom_midtick_color boxplot_minmax_2D_vertical boxplot_tooltip_aggregate boxplot_tooltip_not_aggregate brush_table circle circle_binned circle_binned_maxbins_2 circle_binned_maxbins_20 circle_binned_maxbins_5 circle_bubble_health_income circle_flatten circle_github_punchcard circle_natural_disasters circle_opacity circle_scale_quantile circle_scale_quantize circle_scale_threshold concat_bar_layer_circle concat_bar_scales_discretize concat_bar_scales_discretize_2_cols concat_hover concat_hover_filter concat_layer_voyager_result_future concat_marginal_histograms concat_population_pyramid concat_weather connected_scatterplot embedded_csv errorband_2d_horizontal_color_encoding errorband_2d_vertical_borders errorbar_2d_vertical_ticks errorbar_aggregate errorbar_horizontal_aggregate facet_bullet facet_column_facet_column_point_future facet_column_facet_row_point_future facet_cross_independent_scale facet_custom facet_custom_header facet_independent_scale facet_independent_scale_layer_broken facet_row_facet_row_point_future geo_choropleth geo_circle geo_constant_value geo_custom_projection geo_graticule geo_graticule_object geo_layer geo_layer_line_london geo_layer_multi geo_line geo_point geo_repeat geo_rule geo_sphere geo_text geo_trellis hconcat_weather histogram histogram_bin_change histogram_bin_transform histogram_log histogram_no_spacing histogram_ordinal histogram_ordinal_sort interactive_area_brush interactive_bar_select_highlight interactive_brush interactive_concat_layer interactive_dashboard_europe_pop interactive_layered_crossfilter interactive_layered_crossfilter_discrete interactive_multi_line_label interactive_multi_line_tooltip interactive_overview_detail interactive_paintbrush interactive_paintbrush_color interactive_paintbrush_color_nearest interactive_paintbrush_interval interactive_paintbrush_simple_all interactive_paintbrush_simple_none interactive_panzoom_splom interactive_panzoom_vconcat_shared interactive_query_widgets interactive_seattle_weather interactive_splom interactive_stocks_nearest_index isotype_bar_chart isotype_bar_chart_emoji isotype_grid joinaggregate_mean_difference joinaggregate_mean_difference_by_year joinaggregate_percent_of_total joinaggregate_residual_graph layer_bar_annotations layer_bar_labels layer_bar_labels_style layer_bar_line layer_bar_line_union layer_bar_month layer_boxplot_circle layer_candlestick layer_circle_independent_color layer_color_legend_left layer_cumulative_histogram layer_dual_axis layer_falkensee layer_histogram layer_histogram_global_mean layer_line_co2_concentration layer_line_color_rule layer_line_errorband_2d_horizontal_borders_strokedash layer_line_errorband_ci layer_line_errorband_pre_aggregated layer_line_mean_point_raw layer_overlay layer_point_errorbar_1d_horizontal layer_point_errorbar_1d_vertical layer_point_errorbar_2d_horizontal layer_point_errorbar_2d_horizontal_ci layer_point_errorbar_2d_horizontal_color_encoding layer_point_errorbar_2d_horizontal_custom_ticks layer_point_errorbar_2d_horizontal_iqr layer_point_errorbar_2d_horizontal_stdev layer_point_errorbar_2d_vertical layer_point_errorbar_ci layer_point_errorbar_pre_aggregated_asymmetric_error layer_point_errorbar_pre_aggregated_symmetric_error layer_point_errorbar_pre_aggregated_upper_lower layer_point_errorbar_stdev layer_precipitation_mean layer_ranged_dot layer_rect_extent layer_scatter_errorband_1D_stdev_global_mean layer_scatter_errorband_1d_stdev layer_single_color layer_text_heatmap line line_calculate line_color line_color_binned line_detail line_encoding_impute_keyvals line_encoding_impute_keyvals_sequence line_impute_frame line_impute_keyvals line_impute_method line_impute_transform_frame line_impute_transform_value line_impute_value line_inside_domain_using_clip line_inside_domain_using_transform line_max_year line_mean_month line_mean_year line_monotone line_month line_outside_domain line_overlay line_overlay_stroked line_quarter_legend line_shape_overlay line_skip_invalid line_skip_invalid_mid line_skip_invalid_mid_cap_square line_skip_invalid_mid_overlay line_slope line_step line_timeunit_transform lookup parallel_coordinate point_1d point_1d_array point_2d point_2d_aggregate point_2d_array point_2d_array_named point_2d_tooltip_data point_aggregate_detail point_background point_binned_color point_binned_opacity point_binned_size point_bubble point_color point_color_custom point_color_ordinal point_color_quantitative point_color_shape_constant point_color_with_shape point_colorramp_size point_diverging_color point_dot_timeunit_color point_filled point_href point_invalid_color point_log point_no_axis_domain_grid point_ordinal_color point_overlap point_shape_custom point_tooltip rect_binned_heatmap rect_heatmap rect_heatmap_weather rect_lasagna_future rect_mosaic_labelled rect_mosaic_labelled_with_offset rect_mosaic_simple repeat_histogram repeat_histogram_flights repeat_independent_colors repeat_layer repeat_line_weather repeat_splom_cars repeat_splom_iris rule_color_mean rule_extent sample_scatterplot selection_bind_cylyr selection_bind_origin selection_brush_timeunit selection_clear_brush selection_composition_and selection_composition_or selection_concat selection_filter selection_filter_composition selection_heatmap selection_insert selection_interval_mark_style selection_layer_bar_month selection_multi_condition selection_project_binned_interval selection_project_interval selection_project_interval_x selection_project_interval_x_y selection_project_interval_y selection_project_multi selection_project_multi_cylinders selection_project_multi_cylinders_origin selection_project_multi_origin selection_project_single selection_project_single_cylinders selection_project_single_cylinders_origin selection_project_single_origin selection_resolution_global selection_resolution_intersect selection_resolution_union selection_toggle_altKey selection_toggle_altKey_shiftKey selection_toggle_shiftKey selection_translate_brush_drag selection_translate_brush_shift-drag selection_translate_scatterplot_drag selection_translate_scatterplot_shift-drag selection_type_interval selection_type_interval_invert selection_type_multi selection_type_single selection_type_single_dblclick selection_type_single_mouseover selection_zoom_brush_shift-wheel selection_zoom_brush_wheel selection_zoom_scatterplot_shift-wheel selection_zoom_scatterplot_wheel sequence_line square stacked_area stacked_area_normalize stacked_area_ordinal stacked_area_overlay stacked_area_stream stacked_bar_1d stacked_bar_count stacked_bar_h stacked_bar_h_order stacked_bar_h_order_custom stacked_bar_normalize stacked_bar_population stacked_bar_population_transform stacked_bar_size stacked_bar_sum_opacity stacked_bar_unaggregate stacked_bar_v stacked_bar_weather test_aggregate_nested test_field_with_spaces test_single_point_color test_subobject test_subobject_missing test_subobject_nested text_format text_scatterplot_colored tick_dot tick_dot_thickness tick_sort tick_strip time_output_utc_scale time_output_utc_timeunit time_parse_local time_parse_utc time_parse_utc_format trail_color trellis_anscombe trellis_area trellis_area_sort_array trellis_bar trellis_bar_histogram trellis_bar_histogram_label_rotated trellis_barley trellis_barley_independent trellis_barley_layer_median trellis_column_year trellis_cross_sort trellis_cross_sort_array trellis_line_quarter trellis_row_column trellis_scatter trellis_scatter_binned_row trellis_scatter_small trellis_selections trellis_stacked_bar vconcat_flatten vconcat_weather waterfall_chart wheat_wages window_cumulative_running_average window_percent_of_total window_rank window_top_k window_top_k_others
abstractVegaNode
 frequency .1
 catchAllCellType titleCell
 string tileSize 800 300
 string tileScript maia/packages/vega/vega.combined.min.js
 string dummyDataSet stockPrice
 string mark bar
 extends abstractBodyOnlyTileNode
 abstract
 javascript
  // todo: I don't think vega handles . in column names.
  getTileBodyStumpCode() {
   return `div
  class divWhereVegaWillGo`
  }
  _getColumnToField(columnName) {
   if (!columnName) return undefined
   const columnsMap = this.getParentOrDummyTable().getColumnsMap()
   const col = columnsMap[columnName]
   const obj = { field: columnName, type: col.getVegaType() }
   if (col.isTemporal()) {
    const timeUnit = col.getVegaTimeUnit()
    if (timeUnit) obj.timeUnit = timeUnit
   }
   return obj
  }
  async _createVegaEmbedded(el, spec) {
   const embedded = await vegaEmbed(el, spec)
   return embedded
  }
  _adjustVegaSize() {
   const adjustSize = !this.has("width")
   if (adjustSize) {
    const shadow = this.getStumpNode()
     .findStumpNodeByChild("class divWhereVegaWillGo")
     .getShadow()
    this.set("width", Math.round((30 + shadow.getShadowOuterWidth()) / 20) + "")
    this.set("height", Math.round((30 + shadow.getShadowOuterHeight()) / 20) + "")
   }
  }
  treeComponentDidUpdate() {
   super.treeComponentDidUpdate()
   if (this.isNodeJs()) return undefined
   const shadow = this.getStumpNode()
    .findStumpNodeByChild("class divWhereVegaWillGo")
    .getShadow()
   // todo: don't rerun this if we dont need to.
   this._createVegaEmbedded(shadow.getShadowElement(), this._getVegaSpec())
   // this._adjustVegaSize()
  }
  _getTileWidth() {
   return this.getTileDimensionIfAny().width - 120
  }
  _getTileHeight() {
   return this.getTileDimensionIfAny().height - 120
  }
  treeComponentDidMount() {
   this.treeComponentDidUpdate()
  }
  _getVegaData() {
   return {
    values: this.getParentOrDummyTable()
     .cloneNativeJavascriptTypedRows()
     .slice(0, this._getRowDisplayLimit())
   }
  }
  _getVegaTitle() {
   return this.getContent()
  }
  _getVegaSpec() {
   return {
    description: "A simple bar chart with embedded data.",
    data: this._getVegaData(),
    width: this._getTileWidth(),
    height: this._getTileHeight(),
    mark: this._getVegaMarkObj(),
    encoding: this._getEncodingMap(),
    transform: this._getVegaTransform(),
    title: this._getVegaTitle(),
    config: this._getVegaConfig()
   }
  }
  _getVegaTransform() {
   return undefined
  }
  _getVegaConfig() {
   return undefined
  }
  _getEncodingMap() {
   return {}
  }
  // todo: add type
  _getVegaMarkObj() {
   return { type: this._getVegaMark(), tooltip: { content: "data" } }
  }
  _getVegaMark() {
   return this.getDefinition().getConstantsObject()["mark"]
  }
vegaBarNode
 description A bar chart
 inScope xColumnNode yColumnNode colorColumnNode shapeColumnNode
 javascript
  _getEncodingMap() {
   const columnNames = this.mapSettingNamesToColumnNames([this.xColumnKey, this.yColumnKey, this.colorColumnKey])
   return {
    x: this._getColumnToField(columnNames[0]),
    y: this._getColumnToField(columnNames[1]),
    color: this._getColumnToField(columnNames[2])
   }
  }
 string columnPredictionHints
  xColumn
  yColumn isString=false,!xColumn
 extends abstractVegaNode
 crux vega.bar
vegaHistogramNode
 description A histogram
 inScope xColumnNode
 javascript
  _getEncodingMap() {
   const columnName = this.getContent() || this.mapSettingNamesToColumnNames([this.xColumnKey])[0]
   return {
    x: {
     bin: true,
     field: columnName,
     type: "quantitative"
    },
    y: {
     aggregate: "count",
     type: "quantitative"
    }
   }
  }
 string columnPredictionHints
  xColumn isString=false
 string dummyDataSet wordCounts
 extends abstractVegaNode
 crux vega.histogram
vegaDataNode
 cells tileKeywordCell vegaDataSetCell
 frequency .001
 description Fetchs a Vega sample dataset
 string urlPrefix maia/packages/vega/datasets/
 extends abstractFixedDatasetFromMaiaCollectionNode
 crux vega.data
vegaDataListNode
 description View all available Vega datasets
 frequency .001
 string title All Vega datasets:
 string itemFormat {id}
 extends abstractSnippetGalleryNode
 crux vega.data.list
 javascript
  getGalleryNodes() {
   // todo: cleanup this line.
   const node = this.getWebApp()
    .getMaiaGrammarAsTree()
    .getNodesByRegex(/^vegaDataSetCell/)[0]
   return new jtree.TreeNode(
    node
     .get("enum")
     .split(" ")
     .map(item => {
      return {
       id: item
      }
     })
   )
  }
  getSnippetTemplate(id) {
   return `vega.data ${id}`
  }
vegaExampleListNode
 description View all available Vega examples
 frequency .001
 string title All Vega examples:
 string itemFormat {id}
 extends abstractSnippetGalleryNode
 crux vega.example.list
 javascript
  getGalleryNodes() {
   // todo: cleanup this line.
   const node = this.getWebApp()
    .getMaiaGrammarAsTree()
    .getNodesByRegex(/^vegaExampleNameCell/)[0]
   return new jtree.TreeNode(
    node
     .get("enum")
     .split(" ")
     .map(item => {
      return {
       id: item
      }
     })
   )
  }
  getSnippetTemplate(id) {
   return `vega.example ${id}`
  }
vegaExampleNode
 description Shows a chart from the Vega Example Gallery
 frequency .001
 cells tileKeywordCell vegaExampleNameCell
 example
  vega.example trellis_anscombe
 extends abstractVegaNode
 crux vega.example
 javascript
  _getVegaSpec() {
   return this._spec
  }
  async _fetchSpec() {
   // todo: localtesting.
   if (this.isNodeJs()) return undefined
   const exampleName = this.getContent() || "area" // todo: pull this default from the gram?
   const url = `maia/packages/vega/ignore/vega-lite/examples/compiled/${exampleName}.vg.json`
   const res = await this.getWebApp()
    .getWillowProgram()
    .httpGetUrl(url)
   const spec = JSON.parse(res.text)
   // rewrite data urls
   spec.data.forEach(row => {
    if (row.url) row.url = row.url.replace("data/", "packages/vega/datasets/")
   })
   this._spec = spec
   return spec
  }
  // todo: clean this up.
  async fetchTableInputs() {
   const spec = await this._fetchSpec()
   if (this.isNodeJs()) return { rows: [] }
   const el = jQuery("<div></div>")[0]
   const embedded = await vegaEmbed(el, spec)
   const rows = await this._getVegaPostTransformOutputRows(spec, embedded)
   return { rows: rows }
  }
  async _getVegaPostTransformOutputRows(spec, embedded) {
   const tableName = spec.data[0] && spec.data[0].name
   if (tableName) return embedded.view.data(tableName)
   // const values = spec.data.values
   // if (values && values.entries) return Array.from(values.entries())
   // if (typeof values === "function") return []
   // else if (values) return values
   return []
  }
vegaLineNode
 description A line chart
 string mark line
 extends vegaBarNode
 crux vega.line
vegaAreaNode
 description An area chart
 string mark area
 extends vegaLineNode
 crux vega.area
vegaScatterNode
 description A scatterplot
 string mark point
 extends vegaBarNode
 crux vega.scatter
 javascript
  _getEncodingMap() {
   const columnNames = this.mapSettingNamesToColumnNames([this.xColumnKey, this.yColumnKey, this.colorColumnKey, this.shapeColumnKey])
   return {
    x: this._getColumnToField(columnNames[0]),
    y: this._getColumnToField(columnNames[1]),
    color: this._getColumnToField(columnNames[2]),
    shape: this._getColumnToField(columnNames[3])
   }
  }
vegaBubbleNode
 description A bubble plot
 inScope sizeColumnNode colorColumnNode
 string mark circle
 string dummyDataSet gapMinder
 string columnPredictionHints
  sizeColumn isString=false
  xColumn isString=false
 extends vegaScatterNode
 crux vega.bubble
 javascript
  _getEncodingMap() {
   const columnNames = this.mapSettingNamesToColumnNames([this.xColumnKey, this.yColumnKey, this.sizeColumnKey, this.colorColumnKey])
   return {
    y: {
     field: columnNames[1],
     type: "quantitative",
     scale: { zero: false },
     axis: { minExtent: 30 }
    },
    x: this._getColumnToField(columnNames[0]),
    size: { field: columnNames[2], type: "quantitative" },
    color: { value: "#000" }
   }
  }
emojiColumnNode
 extends abstractColumnNode
 crux emojiColumn
vegaEmojiNode
 description A bar chart with emojis
 frequency .001
 inScope yColumnNode emojiColumnNode
 string columnPredictionHints
  emojiColumn isString=true
  yColumn isString=false
 string dummyDataSet emojis
 javascript
  _getVegaConfig() {
   return { view: { stroke: "" } }
  }
  _getVegaMark() {
   return { type: "text", baseline: "middle" }
  }
  _getEncodingMap() {
   const columnNames = this.mapSettingNamesToColumnNames([this.yColumnKey, "emoji"])
   return {
    x: { field: columnNames[1], type: "nominal", axis: null },
    y: { field: columnNames[0], type: "quantitative", axis: null, sort: null },
    text: { field: columnNames[1], type: "nominal" },
    size: { value: 65 }
   }
  }
 extends vegaBarNode
 crux vega.emoji